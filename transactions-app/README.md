# Transactions App

## Overview

This is a simple transactions app written in Java & Spring boot.

## Getting Started

Start by launching the database.

```bash
docker compose up -d
```

You can then run the application as you would run any other spring boot application.

## Backend Overview

Below we will describe the database schema we used and the endpoints implemented in the transactions app.

### Database Schema

- `clients`:
  - id
  - name
  - lastname

- `accounts`:
  - id
  - clientId
  - balance

- `transactions` ( mapped and not necessarily created ):
  - id
  - amount
  - timestamp

- `exchange_transactions`:
  - senderId:
  - receiverId:
  - transactionId

- `account_transactions`:
  - accountId:
  - type: `WITHDRAW` / `DEPOSIT`
  - transactionId

---


### Errors : 

This is an example of an error. Generated by the exception handler:

```json
{
	"timestamp": "2022-11-22T10:43:46.210+00:00",
	"status": 400,
	"error": "Bad Request",
	"message": "[Transactions] : Insufficient Funds",
	"path": "/transactions/withdraw"
}
```

### Endpoints :

**URI** :  /transactions/withdraw

**HTTP Method** : PUT

```json
{
  "accountId": 1,
  "Amount": 100
}
```

Resp (similar to deposit)

---

**URI** : /transactions/deposit

**HTTP Method** : PUT

```json
{
    "accountId": 1,
    "Amount": 100
}
```

Resp ( Success ):

```json
{
  "message" : "transaction successful",
  "transactionId": 1,
  "timestamp": "date+hms",
  "amount": 100,
  "type": "DEPOSIT"
}
```

---

**URI** : /transactions/send

**HTTP Method** : PUT

```json
{
  "message" : "transaction successful",
  "transactionId": 1,
  "amount": 100,
  "senderId": 1,
  "receiverId": 2
}
```

---


**Description** : This will return all transactions for an account. Whether the user is the `sender` or a `receiver` of an `Exchange transaction`. Or whether he did a `withdraw` or a `deposit` via an `Account transaction`

**URI** : /transactions/accounts/:accountId

**HTTP Method** : GET

```json
{
  "accountTransactions": [
    {
      "id": 1,
      "amount": 500.0,
      "timestamp": "date+hms",
      "accountId": 1,
      "type": "DEPOSIT"
    },
    {}
  ],
  "exchangeTransactions": [
    {
      "id": 3,
      "amount": 500.0,
      "timestamp": "date+hms",
      "senderId": 1,
      "receiverId": 2
    },
    {}
  ]
}
```

---

**URI** : /accounts/:clientId

**HTTP Method** : GET

```json
{
  "accounts": [
    {
      "id": 148,
      "balance": 1000.0
      },
    {

    }
  ]
}
```

## Code Structure

### Database

In order to save the data somewhere. We created a small `postgres` database with a few tables. The structure of the tables and the used database type is still open for discussion.

### Migration

When starting up the spring boot server. We added a small hook to clear the database, and create a few users and accounts. We can always change this if it's not flexible enough.

### Controllers

Two controllers have been implemented : 

- `/transactions` : Handle all transactions requests and queries
- `/accounts` : Used to get the accounts of a certain client

### Exception Handling 

An exception handler has been implemented for both controllers to handle the different errors that might arise ( Withdraw an amount that's more than the balance, account not found... )